 # Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Введение

Перед выполнением задания вы можете ознакомиться с 
[дополнительными материалами](https://github.com/netology-code/virt-homeworks/tree/master/additional/README.md).

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
  - документо-ориентированная СУБД (возможность хранить данные разного типа)
- Склады и автомобильные дороги для логистической компании
  - реляционная СУБД (проще ереализовать с помощью взаимосвязанных таблиц)
- Генеалогические деревья
  - сетевая СУБД (более обного родителя)
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
  - key-value (можно задать время жизни для каждой записи)
- Отношения клиент-покупка для интернет-магазина
   - key-value СУБД (можно задать время жизни для каждой записи)

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись) 
  - AP
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
  - СР
- Система может не прислать корректный ответ или сбросить соединение 
  - СР
```
CA (Availability + Consistency – Parition tolerance), когда данные во всех узлах кластера согласованы и доступны, но не устойчивы к разделению. Это означает, что реплики одной и той же информации, распределенные по разным серверам друг другу, не противоречат друг другу и любой запрос к распределённой системе завершается корректным откликом. Такие системы возможны при поддержке ACID-требований к транзакциям (Атомарность, Согласованность, Изоляция, Долговечность) и абсолютной надежности сети. На практике таких решений на основе кластерных систем управления базами данных почти не существует. Классическим примером CA-системы называют распределённую службу каталогов LDAP, а также реляционные базы данных (PostgreSQL, MySQL, MariaDB, MS SQL Server).
CP-система (Consistency + Partition tolerance – Availability) в каждый момент обеспечивает целостность данных и способна работать в условиях распада в ущерб доступности, не выдавая отклик на запрос. Устойчивость к разделению требует дублирования изменений во всех узлах системы, что реализуется с помощью распределённых пессимистических блокировок для сохранения целостности. По сути, CP – это система с несколькими синхронно обновляемыми мастер-базами. Она всегда корректна, отрабатывая транзакцию, только в том случае, если изменения удалось распространить по всем серверам. Она продолжает корректно читать данные даже при отказе одного из узлов кластера. Но в этом случае запись будет обрываться или сильно задерживаться, пока система не убедится в своей целостности и согласованности (консистентности). Из NoSQL-СУБД к CP-системам принято относить Apache HBase, MongoDB, Redis, MemcasheDB, Berkley DB, HyperTable и Google Big Table.
AP-система (Availability + Partition tolerance – Consistency) не гарантирует целостность данных, обеспечивая их доступность и устойчивость к разделению, например, как в распределённых веб-кэшах и DNS. Считается, что большинство NoSQL-СУБД относятся к этому классу систем, обеспечивая лишь некоторой уровень согласованности данных в конечном счете (eventually consistent). Таким образом, AP-система может быть представлена кластером из нескольких узлов, каждый из которых может принимать данные, но не обязуется в тот же момент распространять их на другие сервера. Такая система отлично справляется с отказами нескольких узлов, но, когда они снова начинают работать, возможна выдача пользователям старых данных. К AP-системам относят CoucheDB, Cassandra, Riak, Amazon DynamoDB.
```
А согласно PACELC-теореме, как бы вы классифицировали данные реализации?
```text
    1. - PA/EL
    2. - PA/EL
    3. - PC/EC
```
```text
PACELC

В данной теореме мы видим не просто треугольник СAP, а условное дерево, которое можно представить в виде if (P, then A or C, else L or C), где есть уже знакомые нам (P)artitioning, (A)valability, (С)onsistency, а также новое понятие (L)atency – общее время задержки от момента выполнения действия пользователем до момента предоставления ему результата. Краткий вид (L)atency – время на доставку действия пользователя к системе + время на обработку действия + время на доставку ответа от системы к пользователю. (E)lse – иначе. Простыми словами, при условии наличия сетевого разделения (P)artitioning система может выбрать одно из двух: доступность (A)vailability или консистентность (С)onsistensy, иначе (E)lse, если сетевого разделения нет, система может выбрать одно из двух: время задержки (L)atency или консистентность (С)onsistensy. Опишем две стороны работы одной системы:
1. При сетевом разделении система или консистентна, или доступна.
2. Без сетевого разделения – или консистентна, или обеспечивает высокую скорость ответа.
Система, которая стремится к консистентности и при сетевом разделении, и без него, обозначается так: PC/EC.
Отметим, что хоть PACELC и расширила возможности для классификации систем, добавив параметр «скорость ответа», но одновременно унаследовала и остальные проблемы классической CAP-теоремы, которые были рассмотрены выше. В CAP в режиме без сетевого разделения система классифицировалась как CA – доступная и консистентная, но как мы уже говорили, обсуждая проблемы консистентности, географически сильно разнесённая система в режиме строгой консистентности будет иметь весьма существенное время отклика. Вероятно, такую систему доступной назвать сложно, особенно если она и высоконагруженная. Поэтому в PACELC было решено расширить CA-грань, где система будет либо быстро отвечающей, либо строго консистентной.
Так как грани теоремы PACELC стали более детально описывать системы, то назначения систем, использующих разные комбинации граней, могут быть не до конца понятны. Рассмотрим их более детально.

PA/EL

Внутренние бизнес-процессы больших компаний, в частности internet-based, зачастую ставят два условия для решений, предназначенных для хранения и обработки данных: высокая доступность (A) при разделении (P) системы иначе (E) высокая скорость ответа (L).
Выпадение сегмента системы так же, как и высокие показатели скорости работы с данными, гарантированно приводит к серьезным издержкам, как финансовым, так и репутационным. Единовременная консистентность данных здесь играет менее важную роль, хотя тоже существенную.
Примерами БД, которые изначально построены максимально приближено к этой конфигурации, можно назвать:
Cassandra – база данных для работы с системой сообщений от компании Facebook, в дальнейшем переданная Apache Foundation.
Voldemort – платформа, поддерживающая систему массовых записей и обновлений от сервисов LinkedIn (несколько лет назад, по ряду причин компания отказалась от Voldemort в пользу своего нового продукта Venice).
DynamoDB от Amazon.
Riak от Basho Technologies.

PC/EC

Как мы видим по названию, системы, которые стараются максимально приблизиться к парадигме ACID с большой долей вероятности будут жертвовать доступностью (A) в угоду консистентности (С), используя огораживание (fencing) при разделении (P) в распределённых системах. В неразделённых (E)lse системах «под нож» пойдёт скорость (L)atency, так как консистентность – это один из столпов ACID. Также объяснимо применение синхронных коммитов при репликации или максимально приближённых к ним внутренних решений.
Примеры тут:
VoltDB/H-Store – ACID-совместимые БД, разработаны группой ученых. К созданию причастен и сам автор PACELS теории, профессор Дэниель Абади.
Megastore – проект от компании Google, для закрытия определённых ACID-потребностей в собственных облачных хранилищах.

PC/EL

Данная архитектура при разделении стремится оставаться консистентной, а в случае без сетевых разделений, фокусируется на скорости ответа, отводя консистентность на второй план. Классическим, но не идеальным примером данной архитектуры стала PNUTS – база данных, разработанная компанией Yahoo!, которая в распределённых средах обеспечивает «Timeline (С)onsistency» на всех репликах. Для обеспечения данного уровня консистентности система может стать недоступной при отключении реплики мастера. Не сразу понятно, зачем мы идем на компромиссную (С)onsistency при условии, что (A)valability так и не достигнута. Именно это и заставило профессора Абади ввести (L)atency и расширить стандартную CAP-теорему. Тут мы видим суть крупных бизнесов вроде Amazon и Yahoo!, где (L)atency стоят огромных денег. Не используя надёжной системы общей синхронизации, а предоставляя только «Timeline (С)onsistency» для каждой реплики, они повышают общую скорость отклика системы, то есть ради (L)atency жертвуют всем. Однако при определённых настройках PNUTS (A)valability может быть гарантирована.

PA/EC

При наличии сетевого разделения системы ставка делается на доступность, а при отсутствии распределения – на консистентность. Со слов самого автора теории PACELS – In Memory Data Grid, решения в определённых конфигурациях имеют характеристики PA/EC. В частности, решение Hazelcast может быть сконфигурировано с использованием специальной настройки гибридной синхронности. В случае разделения – (P)artitioning, сконфигурированная таким образом система не даст консистентности, но предоставит (A)valability, а в (E)lse и строгую (С)onsistency.

```
## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?
```text
Думаю сочетаться не могут т.к. принципы BASE отличается от ACID и не предоставляет гарантии изоляции,
не предоставляет гарантии атомарности.
```
 

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

```text


    
    Минусы при выборе данной системы:
    1. не предоставляет стандартные возможности баз данных вроде атомарности транзакций 
    или согласованности данных при одновременном выполнении нескольких транзакций. 
    Такие возможности должны предоставляться самим приложением.
    
    2. при увеличении объёмов данных, поддержание уникальных ключей может стать проблемой
```

---

### Как cдавать задание

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
